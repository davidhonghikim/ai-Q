{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Recipe Schema",
  "description": "Schema for recipes that orchestrate pantry ingredients to create complete workflows",
  "type": "object",
  "required": ["id", "name", "version", "description", "ingredients", "steps", "orchestrator"],
  "properties": {
    "id": {
      "type": "string",
      "description": "Unique recipe identifier",
      "pattern": "^[a-z0-9-]+:[0-9]+\\.[0-9]+\\.[0-9]+$",
      "examples": ["deploy-ollama-service:1.0.0", "setup-monitoring-stack:2.1.0"]
    },
    "name": {
      "type": "string",
      "description": "Human-readable recipe name",
      "minLength": 1,
      "maxLength": 100
    },
    "version": {
      "type": "string",
      "description": "Semantic version string",
      "pattern": "^[0-9]+\\.[0-9]+\\.[0-9]+$"
    },
    "description": {
      "type": "string",
      "description": "Detailed description of what this recipe accomplishes",
      "minLength": 10,
      "maxLength": 1000
    },
    "ingredients": {
      "type": "array",
      "description": "List of pantry ingredients required by this recipe",
      "items": {
        "type": "object",
        "required": ["registry_id", "version"],
        "properties": {
          "registry_id": {
            "type": "string",
            "description": "Registry ID of the pantry ingredient"
          },
          "version": {
            "type": "string",
            "description": "Required version of the ingredient"
          },
          "alias": {
            "type": "string",
            "description": "Optional alias for referencing this ingredient in steps"
          }
        }
      },
      "minItems": 1
    },
    "steps": {
      "type": "array",
      "description": "Ordered execution steps, each referencing a pantry ingredient",
      "items": {
        "type": "object",
        "required": ["step_id", "ingredient_ref", "description"],
        "properties": {
          "step_id": {
            "type": "string",
            "pattern": "^[A-Z0-9-]+$"
          },
          "ingredient_ref": {
            "type": "string",
            "description": "Reference to ingredient (registry_id or alias)"
          },
          "description": {
            "type": "string",
            "description": "What this step accomplishes"
          },
          "inputs": {
            "type": "object",
            "description": "Inputs to pass to the ingredient"
          },
          "outputs": {
            "type": "object",
            "description": "Expected outputs from this step"
          },
          "validation": {
            "type": "object",
            "description": "Validation rules for this step"
          },
          "error_handling": {
            "type": "string",
            "enum": ["continue", "retry", "fail", "rollback"],
            "description": "How to handle errors in this step"
          },
          "parallel": {
            "type": "boolean",
            "description": "Whether this step can run in parallel with others"
          },
          "delegate_to": {
            "type": "string",
            "description": "Agent role to delegate this step to"
          }
        }
      },
      "minItems": 1
    },
    "orchestrator": {
      "type": "object",
      "description": "Configuration for the orchestrator agent (chef)",
      "required": ["agent_role", "execution_policy"],
      "properties": {
        "agent_role": {
          "type": "string",
          "description": "Role of the agent executing this recipe"
        },
        "execution_policy": {
          "type": "string",
          "enum": ["sequential", "parallel", "mixed"],
          "description": "How to execute the steps"
        },
        "timeout": {
          "type": "number",
          "description": "Maximum execution time in seconds"
        },
        "retry_policy": {
          "type": "object",
          "properties": {
            "max_retries": {
              "type": "number"
            },
            "retry_delay": {
              "type": "number"
            }
          }
        }
      }
    },
    "inputs": {
      "type": "object",
      "description": "Required inputs for the entire recipe",
      "additionalProperties": {
        "type": "object",
        "properties": {
          "type": {
            "type": "string",
            "enum": ["string", "number", "boolean", "file", "directory"]
          },
          "required": {
            "type": "boolean"
          },
          "default": {
            "description": "Default value if not provided"
          },
          "description": {
            "type": "string"
          }
        }
      }
    },
    "outputs": {
      "type": "object",
      "description": "Outputs produced by the recipe",
      "additionalProperties": {
        "type": "object",
        "properties": {
          "type": {
            "type": "string",
            "enum": ["string", "number", "boolean", "file", "directory", "json"]
          },
          "description": {
            "type": "string"
          }
        }
      }
    },
    "dependencies": {
      "type": "array",
      "description": "Other recipes this recipe depends on",
      "items": {
        "type": "string"
      }
    },
    "tags": {
      "type": "array",
      "description": "Tags for categorization and search",
      "items": {
        "type": "string"
      }
    },
    "author": {
      "type": "string",
      "description": "Creator of this recipe"
    },
    "last_updated": {
      "type": "string",
      "format": "date-time",
      "description": "ISO timestamp of last update"
    },
    "signature": {
      "type": "string",
      "description": "Cryptographic or unique signature for auditability"
    },
    "validation": {
      "type": "object",
      "description": "Validation rules for the recipe",
      "properties": {
        "pre_execution": {
          "type": "array",
          "items": {
            "type": "string"
          }
        },
        "post_execution": {
          "type": "array",
          "items": {
            "type": "string"
          }
        }
      }
    },
    "example_usage": {
      "type": "object",
      "description": "Example of how to use this recipe",
      "properties": {
        "inputs": {
          "type": "object"
        },
        "expected_outputs": {
          "type": "object"
        }
      }
    }
  }
} 